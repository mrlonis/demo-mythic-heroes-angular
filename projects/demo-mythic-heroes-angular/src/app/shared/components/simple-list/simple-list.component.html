<div class="table-container">
  <mat-spinner *ngIf="isLoadingResults"></mat-spinner>

  <table
    mat-table
    [dataSource]="dataSource"
    matSort
    (matSortChange)="sortChanged($event)"
    id="locations-table"
    class="mrlonis-table"
  >
    <ng-container *ngFor="let column of data.displayedColumns" [matColumnDef]="column">
      <ng-container *ngIf="data.columnInfo[column].sortable">
        <th mat-header-cell [style.width]="data.columnInfo[column].width" mat-sort-header *matHeaderCellDef>
          {{ data.columnInfo[column].name }}
        </th>
      </ng-container>
      <ng-container *ngIf="!data.columnInfo[column].sortable">
        <th mat-header-cell [style.width]="data.columnInfo[column].width" *matHeaderCellDef>
          {{ data.columnInfo[column].name }}
        </th>
      </ng-container>
      <td mat-cell *matCellDef="let item">
        <ng-container *ngIf="item.customRow">
          <ng-container *ngTemplateOutlet="richRows[column].templateRef"></ng-container>
        </ng-container>
        <ng-container *ngIf="!item.customRow">
          <ng-container *ngIf="isRich(item.item[column])">
            <ng-container
              *ngTemplateOutlet="richColumns[column].templateRef; context: { item: item.item[column].data }"
            ></ng-container>
          </ng-container>
          <ng-container *ngIf="!isRich(item.item[column])">
            <ng-container *ngIf="isString(item.item[column])">
              {{ item.item[column] }}
            </ng-container>
            <ng-container *ngIf="!isString(item.item[column])">
              {{ item.item[column] | async }}
            </ng-container>
          </ng-container>
        </ng-container>
      </td>
    </ng-container>

    <ng-container *ngIf="data.rowEndings !== 'none'" matColumnDef="end-symbol">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let elem" mrlonisMenuProvider #menuCell="mrlonisMenuProvider">
        <ng-container *ngIf="data.rowEndings === 'arrow'">
          <mat-icon class="maticon">chevron_right</mat-icon>
        </ng-container>
        <ng-container *ngIf="data.rowEndings === 'menu'">
          <mat-menu matMenu *ngFor="let menu of serializedMenu" [mrlonisListMenu]="menu.name">
            <ng-container *ngFor="let item of menu.options">
              <button *ngIf="item.action.func" mat-menu-item (click)="item.action.func(elem.item)">
                {{ item.name }}
              </button>
              <button
                *ngIf="item.action.submenu"
                mat-menu-item
                [matMenuTriggerFor]="menuCell.linker.data[item.action.submenu]"
              >
                {{ item.name }}
              </button>
            </ng-container>
          </mat-menu>
          <button
            *ngIf="serializedMenu.length"
            mat-button
            #menuTrigger
            class="optionsdotsbutton"
            (click)="silence($event)"
            [matMenuTriggerFor]="menuCell.linker.data['menu']"
          >
            <mat-icon>more_vert</mat-icon>
          </button>
        </ng-container>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true" class="mrlonis-table-header"></tr>
    <tr
      [hidden]="isLoadingResults"
      mat-row
      [ngClass]="{
        clickable: data.clickable,
        selected: this.data.selectedIds[row.item.id]
      }"
      *matRowDef="let row; columns: getDisplayedColumns()"
      (click)="row.customRow || !data.clickable ? 0 : data.click(router, route, row.item.id)"
    ></tr>
  </table>
</div>
<mrlonis-bundle-paginator *ngIf="!data.hidePaginator" [bundle]="bundle" [pageSize]="pageSize" (page)="pageChanged($event)">
</mrlonis-bundle-paginator>
